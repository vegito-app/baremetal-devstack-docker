global:
  enabled: true

server:
  ha:
    enabled: true
    replicas: 1
    raft:
      enabled: false

    config: |
      ui = true

      listener "tcp" {
        tls_disable = 1
        address = "[::]:8200"
        cluster_address = "[::]:8201"
      }
      storage "consul" {
        path = "vault"
        address = "HOST_IP:8500"
      }

      service_registration "kubernetes" {}

      disable_mlock = true

      # Example configuration for using auto-unseal, using Google Cloud KMS. The
      # GKMS keys must already exist, and the cluster must have a service account
      # that is authorized to access GCP KMS.
      seal "gcpckms" {
       project     = "${project_id}"
       region      = "global"
       key_ring    = "${key_ring}"
       crypto_key  = "${crypto_key}"
      }

      # Example configuration for enabling Prometheus metrics.
      # If you are using Prometheus Operator you can enable a ServiceMonitor resource below.
      # You may wish to enable unauthenticated metrics in the listener block above.
      #telemetry {
      #  prometheus_retention_time = "30s"
      #  disable_hostname = true
      #}

  # This configures the Vault Statefulset to create a PVC for audit
  # logs.  Once Vault is deployed, initialized, and unsealed, Vault must
  # be configured to use this for audit logs.  This will be mounted to
  # /vault/audit
  # See https://developer.hashicorp.com/vault/docs/audit to know more
  auditStorage:
    enabled: true
    # Size of the PVC created
    size: 10Gi
    # Location where the PVC will be mounted.
    mountPath: "/vault/audit"
    # Name of the storage class to use.  If null it will use the
    # configured default Storage Class.
    storageClass: null
    # Access Mode of the storage device being used for the PVC
    accessMode: ReadWriteOnce
    # Annotations to apply to the PVC
    annotations: {}
    # Labels to apply to the PVC
    labels: {}
  # extraEnvironmentVars is a list of extra environment variables to set with the stateful set. These could be
  # used to include variables required for auto-unseal.
  extraEnvironmentVars:
    GOOGLE_REGION: global
    GOOGLE_PROJECT: ${project_id}
    GOOGLE_APPLICATION_CREDENTIALS: /etc/vault/secrets/${gcp_creds_secret}/service-account.json
  affinity: ""
  dataStorage:
    enabled: false
  haStorage:
    consul:
      path: vault/
      address: "${consul_helm_release_name}-consul-server:8500"

  extraVolumes:
    - type: secret
      name: ${gcp_creds_secret}
      path: /etc/vault/secrets
ui:
  enabled: true
